<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeTeens - Tu compa√±ero cute</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #fff5f7;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: #555;
        }
        
        .chat-container {
            width: 90%;
            max-width: 400px;
            height: 80vh;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(255, 138, 171, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid #ff8aab;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #ff8aab, #ff6b8b);
            color: white;
            padding: 18px;
            text-align: center;
            font-weight: 600;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            border-bottom: 2px solid #ff8aab;
        }
        
        .chat-header img {
            height: 30px;
            width: 30px;
        }
        
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background-color: #fff9fb;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
            position: relative;
            animation: fadeIn 0.3s ease-out;
            font-size: 0.95rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .bot-message {
            align-self: flex-start;
            background-color: white;
            border-bottom-left-radius: 5px;
            color: #555;
            border: 1px solid #ffe0e8;
        }
        
        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #ff8aab, #ff6b8b);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .chat-input-container {
            display: flex;
            padding: 12px;
            border-top: 2px solid #ffe0e8;
            background-color: white;
            position: relative;
        }
        
        #user-input {
            flex: 1;
            padding: 12px 18px;
            border: 2px solid #ffe0e8;
            border-radius: 25px;
            outline: none;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            color: #555;
            background-color: #fff9fb;
        }
        
        #send-button {
            background: linear-gradient(135deg, #ff8aab, #ff6b8b);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            box-shadow: 0 3px 10px rgba(255, 138, 171, 0.3);
            transition: transform 0.2s;
        }
        
        #send-button:hover {
            transform: scale(1.05);
        }
        
        .typing-indicator {
            display: inline-block;
            padding: 10px 15px;
            background-color: white;
            border-radius: 18px;
            align-self: flex-start;
            border: 1px solid #ffe0e8;
        }
        
        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #ff8aab;
            margin: 0 3px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        .quick-reply {
            display: inline-block;
            background-color: white;
            padding: 8px 14px;
            border-radius: 15px;
            margin: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            border: 1px solid #ffe0e8;
            color: #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .quick-reply:hover {
            background-color: #fff0f5;
            transform: translateY(-2px);
        }
        
        .resources-button {
            background: linear-gradient(135deg, #ff8aab, #ff6b8b);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 15px;
            margin-top: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(255, 138, 171, 0.3);
            transition: transform 0.2s;
            font-weight: 500;
        }
        
        .resources-button:hover {
            transform: translateY(-2px);
        }
        
        .game-button {
            background: linear-gradient(135deg, #a8e6cf, #dcedc1);
            color: #555;
            border: none;
            padding: 10px 16px;
            border-radius: 15px;
            margin-top: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(168, 230, 207, 0.3);
            transition: transform 0.2s;
            font-weight: 500;
        }
        
        .game-button:hover {
            transform: translateY(-2px);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        /* Estilos para m√≥viles */
        @media (max-width: 600px) {
            .chat-container {
                width: 100%;
                height: 100vh;
                border-radius: 0;
                max-width: none;
            }
            
            .chat-header {
                border-radius: 0;
            }
        }
        
        /* Decoraciones cute */
        .cute-decoration {
            position: absolute;
            opacity: 0.1;
            z-index: 0;
        }
        
        .heart {
            color: #ff8aab;
            font-size: 20px;
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #fff0f5;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #ff8aab;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #ff6b8b;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWxsPSJ3aGl0ZSIgZD0iTTI1NiA0OEMxNDEuMSA0OCA0OCAxNDEuMSA0OCAyNTZzOTMuMSAyMDggMjA4IDIwOCAyMDgtOTMuMSAyMDgtMjA4UzM3MC45IDQ4IDI1NiA0OHptMCAzODQuM2MtOTcuMiAwLTE3Ni4zLTc5LjEtMTc2LjMtMTc2LjNTMTU4LjggNzkuNyAyNTYgNzkuN3MxNzYuMyA3OS4xIDE3Ni4zIDE3Ni4zLTM5LjEgMTc2LjMtMTc2LjMgMTc2LjN6bS0yOC4yLTEzNy4zaDEyLjVjMTMuNSAwIDI0LjMtMTAuOCAyNC4zLTI0LjN2LTY0LjVjMC0xMy41LTEwLjgtMjQuMy0yNC4zLTI0LjNoLTEyLjVjLTEzLjUgMC0yNC4zIDEwLjgtMjQuMyAyNC4zdjY0LjVjMCAxMy41IDEwLjggMjQuMyAyNC4zIDI0LjN6bS03Ni41IDBoMTIuNWMxMy41IDAgMjQuMy0xMC44IDI0LjMtMjQuM3YtNjQuNWMwLTEzLjUtMTAuOC0yNC4zLTI0LjMtMjQuM2gtMTIuNWMtMTMuNSAwLTI0LjMgMTAuOC0yNC4zIDI0LjN2NjQuNWMwIDEzLjUgMTAuOCAyNC4zIDI0LjMgMjQuM3oiLz48L3N2Zz4=" alt="Logo">
            SafeTeens - Tu compa√±ero cute
        </div>
        <div class="chat-messages" id="chat-messages">
            <!-- Decoraciones cute -->
            <div class="cute-decoration" style="top: 20%; left: 10%;">üå∏</div>
            <div class="cute-decoration" style="top: 30%; right: 15%;">‚ú®</div>
            <div class="cute-decoration" style="bottom: 20%; left: 20%;">üíñ</div>
            <!-- Los mensajes se agregar√°n aqu√≠ din√°micamente -->
        </div>
        <div class="chat-input-container">
            <input type="text" id="user-input" placeholder="Escribe tu mensaje aqu√≠..." autocomplete="off">
            <button id="send-button">‚û§</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chat-messages');
            const userInput = document.getElementById('user-input');
            const sendButton = document.getElementById('send-button');
            
            let userName = '';
            let currentTopic = '';
            
            // Presentaci√≥n inicial del chatbot
            setTimeout(() => {
                addBotMessage('¬°Hola! Soy SafeTeens, tu compa√±ero de confianza. Estoy aqu√≠ para escucharte y ayudarte con lo que necesites. üòä');
                setTimeout(() => {
                    addBotMessage('Antes de comenzar, ¬øc√≥mo te llamas?');
                }, 1000);
            }, 500);
            
            // Funci√≥n para agregar mensaje del bot
            function addBotMessage(text, isTyping = true) {
                if (isTyping) {
                    const typingIndicator = document.createElement('div');
                    typingIndicator.className = 'typing-indicator';
                    typingIndicator.id = 'typing-indicator';
                    typingIndicator.innerHTML = '<span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>';
                    chatMessages.appendChild(typingIndicator);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    setTimeout(() => {
                        if (document.getElementById('typing-indicator')) {
                            chatMessages.removeChild(document.getElementById('typing-indicator'));
                            const messageElement = document.createElement('div');
                            messageElement.className = 'message bot-message';
                            messageElement.textContent = text;
                            chatMessages.appendChild(messageElement);
                            chatMessages.scrollTop = chatMessages.scrollHeight;
                        }
                    }, 1500);
                } else {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'message bot-message';
                    messageElement.textContent = text;
                    chatMessages.appendChild(messageElement);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }
            
            // Funci√≥n para agregar mensaje del usuario
            function addUserMessage(text) {
                const messageElement = document.createElement('div');
                messageElement.className = 'message user-message';
                messageElement.textContent = text;
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Funci√≥n para agregar respuestas r√°pidas
            function addQuickReplies(replies) {
                const container = document.createElement('div');
                container.style.marginTop = '10px';
                
                replies.forEach(reply => {
                    const quickReply = document.createElement('span');
                    quickReply.className = 'quick-reply';
                    quickReply.textContent = reply;
                    quickReply.addEventListener('click', () => {
                        userInput.value = reply;
                        sendMessage();
                    });
                    container.appendChild(quickReply);
                });
                
                chatMessages.appendChild(container);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Funci√≥n para agregar bot√≥n de recursos
            function addResourcesButton() {
                const button = document.createElement('button');
                button.className = 'resources-button';
                button.textContent = 'üìö Ver recursos de ayuda';
                button.addEventListener('click', () => {
                    showHelpResources();
                });
                chatMessages.appendChild(button);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Funci√≥n para agregar bot√≥n de juego
            function addGameButton() {
                const button = document.createElement('button');
                button.className = 'game-button';
                button.textContent = 'üéÆ Juego interactivo';
                button.addEventListener('click', () => {
                    startInteractiveGame();
                });
                chatMessages.appendChild(button);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Funci√≥n para mostrar recursos de ayuda
            function showHelpResources() {
                addBotMessage('Aqu√≠ tienes algunos recursos que podr√≠an ayudarte:');
                setTimeout(() => {
                    addBotMessage('1. L√≠nea de ayuda para adolescentes: 0800-123-456 (24/7)', false);
                    addBotMessage('2. Centro de apoyo emocional: www.apoyoemocional.com', false);
                    addBotMessage('3. Gu√≠a para manejar el estr√©s: www.saludmental.guia/estres', false);
                    addBotMessage('Recuerda que no est√°s solo/a. Siempre hay personas dispuestas a ayudarte.', false);
                }, 1000);
            }
            
            // Funci√≥n para iniciar juego interactivo
            function startInteractiveGame() {
                if (currentTopic) {
                    addBotMessage(`¬°Genial! Vamos a jugar un juego sobre ${currentTopic.toLowerCase()}.`);
                    
                    if (currentTopic.includes('estr√©s') || currentTopic.includes('ansiedad')) {
                        setTimeout(() => {
                            addBotMessage('Juego de respiraci√≥n: Sigue el patr√≥n de respiraci√≥n que te mostrar√©...', false);
                            setTimeout(() => {
                                addBotMessage('INHALA profundamente por 4 segundos... ‚è≥', false);
                                setTimeout(() => {
                                    addBotMessage('MANT√âN la respiraci√≥n por 4 segundos... ‚è≥', false);
                                    setTimeout(() => {
                                        addBotMessage('EXHALA lentamente por 6 segundos... ‚è≥', false);
                                        setTimeout(() => {
                                            addBotMessage('¬°Bien hecho! Repite esto 3-4 veces cuando te sientas estresado/a.', false);
                                        }, 2000);
                                    }, 2000);
                                }, 2000);
                            }, 1000);
                        }, 1000);
                    } else if (currentTopic.includes('bullying')) {
                        setTimeout(() => {
                            addBotMessage('Juego de roles: Imagina que ves a alguien sufriendo bullying. ¬øQu√© har√≠as?', false);
                            setTimeout(() => {
                                addQuickReplies(['Pedir√≠a ayuda a un adulto', 'Me acercar√≠a a apoyar a la persona', 'Intentar√≠a distraer al agresor']);
                            }, 1000);
                        }, 1000);
                    } else {
                        setTimeout(() => {
                            addBotMessage('Juego de preguntas y respuestas: Te har√© preguntas sobre el tema y veremos cu√°ntas aciertas.', false);
                            startQuizGame();
                        }, 1000);
                    }
                } else {
                    addBotMessage('Vamos a jugar un juego de preguntas y respuestas sobre temas importantes para adolescentes.', false);
                    startQuizGame();
                }
            }
            
            // Funci√≥n para juego de preguntas
            function startQuizGame() {
                const questions = [
                    {
                        question: "¬øQu√© es lo primero que deber√≠as hacer si te sientes muy ansioso/a?",
                        options: ["Ignorarlo", "Respirar profundamente", "Aislarte de todos"],
                        correct: 1,
                        explanation: "Respirar profundamente ayuda a calmar tu sistema nervioso. Es una buena primera respuesta ante la ansiedad."
                    },
                    {
                        question: "Si un amigo te confiesa que est√° pensando en hacerse da√±o, ¬øqu√© deber√≠as hacer?",
                        options: ["Guardar el secreto", "Dec√≠rselo a un adulto de confianza", "Re√≠rte para quitarle importancia"],
                        correct: 1,
                        explanation: "Es importante buscar ayuda de un adulto en estas situaciones, aunque tu amigo te pida que no lo hagas."
                    },
                    {
                        question: "¬øCu√°l es una buena estrategia para manejar el estr√©s escolar?",
                        options: ["Dejar todo para √∫ltima hora", "Organizar un horario de estudio", "No dormir para estudiar m√°s"],
                        correct: 1,
                        explanation: "Organizar un horario de estudio te ayuda a distribuir mejor tu tiempo y reducir el estr√©s."
                    }
                ];
                
                let currentQuestion = 0;
                let score = 0;
                
                function askQuestion() {
                    if (currentQuestion < questions.length) {
                        const q = questions[currentQuestion];
                        addBotMessage(`Pregunta ${currentQuestion + 1}: ${q.question}`);
                        
                        const optionsContainer = document.createElement('div');
                        optionsContainer.style.marginTop = '10px';
                        
                        q.options.forEach((option, index) => {
                            const optionBtn = document.createElement('span');
                            optionBtn.className = 'quick-reply';
                            optionBtn.textContent = option;
                            optionBtn.addEventListener('click', () => {
                                checkAnswer(index, q.correct, q.explanation);
                            });
                            optionsContainer.appendChild(optionBtn);
                        });
                        
                        chatMessages.appendChild(optionsContainer);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    } else {
                        addBotMessage(`¬°Juego terminado! Obtuviste ${score} de ${questions.length} respuestas correctas. ${score >= 2 ? '¬°Excelente! üòä' : 'Sigue aprendiendo, lo har√°s mejor la pr√≥xima vez. üí™'}`);
                    }
                }
                
                function checkAnswer(selected, correct, explanation) {
                    // Eliminar opciones anteriores
                    const lastChild = chatMessages.lastChild;
                    if (lastChild && lastChild.tagName === 'DIV') {
                        chatMessages.removeChild(lastChild);
                    }
                    
                    if (selected === correct) {
                        score++;
                        addBotMessage(`¬°Correcto! ${explanation}`, false);
                    } else {
                        addBotMessage(`Casi. La respuesta correcta es: ${questions[currentQuestion].options[correct]}. ${explanation}`, false);
                    }
                    
                    currentQuestion++;
                    setTimeout(() => {
                        askQuestion();
                    }, 1500);
                }
                
                askQuestion();
            }
            
            // Funci√≥n para dar consejos espec√≠ficos
            function giveSpecificAdvice() {
                switch(currentTopic) {
                    case 'estr√©s y ansiedad':
                        addBotMessage(`Entiendo que necesitas consejos para manejar el estr√©s, ${userName}. Aqu√≠ tienes algunas t√©cnicas:`);
                        setTimeout(() => {
                            addBotMessage('1. Respiraci√≥n 4-7-8: Inhala por 4 segundos, mant√©n por 7, exhala por 8. Repite 3-4 veces.', false);
                            addBotMessage('2. Toma descansos cortos cada hora para estirarte o caminar un poco.', false);
                            addBotMessage('3. Escribe lo que te preocupa en un papel y luego r√≥mpelo simb√≥licamente.', false);
                            addBotMessage('4. Prueba la t√©cnica 5-4-3-2-1: Nombra 5 cosas que ves, 4 que tocas, 3 que oyes, 2 que hueles, 1 que sabes.', false);
                            addBotMessage('5. Escucha m√∫sica relajante o sonidos de naturaleza para calmarte.', false);
                            addGameButton();
                        }, 1000);
                        break;
                        
                    case 'bullying':
                        addBotMessage(`Lamento que est√©s pasando por esto, ${userName}. Algunos consejos importantes:`);
                        setTimeout(() => {
                            addBotMessage('1. No respondas con agresi√≥n, mant√©n la calma lo m√°s posible.', false);
                            addBotMessage('2. Documenta los incidentes: fecha, hora, lo que pas√≥, testigos.', false);
                            addBotMessage('3. Habla con un adulto de confianza (padres, maestro, consejero).', false);
                            addBotMessage('4. Rod√©ate de amigos que te apoyen y te hagan sentir seguro/a.', false);
                            addBotMessage('5. Recuerda que el problema lo tiene quien te molesta, no t√∫.', false);
                            addBotMessage('6. Practica frases asertivas como "D√©jame en paz" o "No me interesa lo que digas".', false);
                            addResourcesButton();
                        }, 1000);
                        break;
                        
                    case 'tristeza':
                        addBotMessage(`Todos nos sentimos tristes a veces, ${userName}. Algunas cosas que pueden ayudar:`);
                        setTimeout(() => {
                            addBotMessage('1. Habla con alguien de confianza sobre c√≥mo te sientes.', false);
                            addBotMessage('2. Haz algo que sol√≠a gustarte, aunque no tengas ganas al principio.', false);
                            addBotMessage('3. Sal a caminar aunque sea 10 minutos. El aire fresco ayuda.', false);
                            addBotMessage('4. Escribe 3 cosas peque√±as por las que est√©s agradecido/a cada d√≠a.', false);
                            addBotMessage('5. Establece una rutina de sue√±o saludable (8-10 horas).', false);
                            addBotMessage('6. Prueba expresar tus sentimientos a trav√©s de arte, m√∫sica o escritura.', false);
                            addResourcesButton();
                        }, 1000);
                        break;
                        
                    case 'amistades':
                        addBotMessage(`Los problemas con amigos pueden ser dif√≠ciles, ${userName}. Algunos consejos:`);
                        setTimeout(() => {
                            addBotMessage('1. Comunica c√≥mo te sientes de manera calmada y honesta.', false);
                            addBotMessage('2. Escucha activamente el punto de vista de tu amigo.', false);
                            addBotMessage('3. Establece l√≠mites saludables en tus relaciones.', false);
                            addBotMessage('4. Recuerda que no todas las amistades son para siempre y eso est√° bien.', false);
                            addBotMessage('5. Busca actividades donde puedas conocer personas con intereses similares.', false);
                            addResourcesButton();
                        }, 1000);
                        break;
                        
                    default:
                        addBotMessage(`Claro, ${userName}. Aqu√≠ tienes algunos consejos generales para sentirte mejor:`);
                        setTimeout(() => {
                            addBotMessage('1. Toma suficiente agua y come alimentos nutritivos.', false);
                            addBotMessage('2. Haz algo de ejercicio, aunque sea estirarte en tu cuarto.', false);
                            addBotMessage('3. Limita el tiempo en redes sociales si te hacen sentir mal.', false);
                            addBotMessage('4. Dedica tiempo a hobbies o actividades que disfrutes.', false);
                            addBotMessage('5. Habla con alguien sobre c√≥mo te sientes - no est√°s solo/a.', false);
                            addQuickReplies(['Estoy estresado/a', 'Tengo problemas con amigos', 'Necesito m√°s ayuda']);
                            addResourcesButton();
                        }, 1000);
                }
            }
            
            // Funci√≥n para extraer el nombre
            function extractName(input) {
                // Elimina signos de puntuaci√≥n y espacios extras
                const cleanInput = input.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g, '').trim();
                
                // Busca patrones comunes
                const patterns = [
                    /(?:me llamo|mi nombre es|soy|me dicen)\s*(\w+)/i,
                    /^(\w+)$/i,
                    /(\w+)(?:\s+me dicen|\s+me llaman)/i
                ];
                
                for (const pattern of patterns) {
                    const match = cleanInput.match(pattern);
                    if (match && match[1]) {
                        return match[1].charAt(0).toUpperCase() + match[1].slice(1).toLowerCase();
                    }
                }
                
                return cleanInput;
            }
            
            // Funci√≥n para manejar la entrada del usuario
            function handleUserInput(input) {
                const lowerInput = input.toLowerCase();
                
                // Si no tenemos el nombre del usuario
                if (!userName) {
                    userName = extractName(input);
                    if (userName.length > 0) {
                        addBotMessage(`¬°Mucho gusto, ${userName}! üòä ¬øEn qu√© puedo ayudarte hoy?`);
                        setTimeout(() => {
                            addQuickReplies(['Estoy estresado/a', 'Tengo problemas con amigos', 'Necesito consejos', 'Quiero jugar algo']);
                        }, 1000);
                    } else {
                        addBotMessage('Por favor, dime tu nombre para que podamos conocernos mejor.');
                    }
                    return;
                }
                
                // Detecci√≥n de solicitud directa de consejos
                if (lowerInput.includes('consejos') || lowerInput.includes('consejo') || 
                    lowerInput.includes('ayuda') || lowerInput.includes('qu√© hago') || 
                    lowerInput.includes('qu√© hacer') || lowerInput.includes('dime algo') ||
                    lowerInput.includes('recomi√©ndame') || lowerInput.includes('por favor') ||
                    lowerInput.includes('necesito ayuda') || lowerInput === 's√≠' || 
                    lowerInput === 'si' || lowerInput === 'yes') {
                    
                    // Si ya hay un tema identificado, dar consejos sobre ese tema
                    if (currentTopic) {
                        giveSpecificAdvice();
                        return;
                    }
                    
                    // Si no hay tema espec√≠fico pero menciona un problema
                    if (lowerInput.includes('estr√©s') || lowerInput.includes('ansiedad') || 
                       lowerInput.includes('nervioso') || lowerInput.includes('agobiado') ||
                       lowerInput.includes('presi√≥n')) {
                        currentTopic = 'estr√©s y ansiedad';
                        giveSpecificAdvice();
                        return;
                    }
                    else if (lowerInput.includes('bullying') || lowerInput.includes('acos') || 
                            lowerInput.includes('molestan') || lowerInput.includes('pelean')) {
                        currentTopic = 'bullying';
                        giveSpecificAdvice();
                        return;
                    }
                    else if (lowerInput.includes('triste') || lowerInput.includes('deprim') || 
                            lowerInput.includes('infeliz') || lowerInput.includes('solo') || 
                            lowerInput.includes('sola') || lowerInput.includes('depresi√≥n')) {
                        currentTopic = 'tristeza';
                        giveSpecificAdvice();
                        return;
                    }
                    else if (lowerInput.includes('amigo') || lowerInput.includes('amiga') || 
                            lowerInput.includes('amistad') || lowerInput.includes('pelea') ||
                            lowerInput.includes('discut√≠')) {
                        currentTopic = 'amistades';
                        giveSpecificAdvice();
                        return;
                    }
                    else {
                        // Si pide consejos sin especificar tema
                        giveSpecificAdvice();
                        return;
                    }
                }
                
                // Detecci√≥n de temas principales
                if (lowerInput.includes('estr√©s') || lowerInput.includes('ansiedad') || 
                   lowerInput.includes('nervioso') || lowerInput.includes('agobiado') ||
                   lowerInput.includes('presi√≥n')) {
                    currentTopic = 'estr√©s y ansiedad';
                    addBotMessage(`Entiendo que te sientes ${lowerInput.includes('estr√©s') ? 'estresado/a' : 'ansioso/a'}, ${userName}. Voy a darte algunos consejos que pueden ayudarte.`);
                    setTimeout(() => {
                        giveSpecificAdvice();
                    }, 1000);
                } 
                else if (lowerInput.includes('bullying') || lowerInput.includes('acos') || 
                        lowerInput.includes('molestan') || lowerInput.includes('pelean')) {
                    currentTopic = 'bullying';
                    addBotMessage(`Lamento escuchar que est√°s teniendo problemas con ${lowerInput.includes('bullying') ? 'bullying' : 'alguien que te molesta'}, ${userName}. Aqu√≠ tienes algunas estrategias:`);
                    setTimeout(() => {
                        giveSpecificAdvice();
                    }, 1000);
                }
                else if (lowerInput.includes('triste') || lowerInput.includes('deprim') || 
                        lowerInput.includes('infeliz') || lowerInput.includes('solo') || 
                        lowerInput.includes('sola') || lowerInput.includes('depresi√≥n')) {
                    currentTopic = 'tristeza';
                    addBotMessage(`Lamento que te sientas as√≠, ${userName}. Todos pasamos por momentos dif√≠ciles. Aqu√≠ hay algunas cosas que pueden ayudar:`);
                    setTimeout(() => {
                        giveSpecificAdvice();
                    }, 1000);
                }
                else if (lowerInput.includes('amigo') || lowerInput.includes('amiga') || 
                        lowerInput.includes('amistad') || lowerInput.includes('pelea') ||
                        lowerInput.includes('discut√≠')) {
                    currentTopic = 'amistades';
                    addBotMessage(`Los problemas con amigos pueden ser complicados, ${userName}. Te comparto algunos consejos:`);
                    setTimeout(() => {
                        giveSpecificAdvice();
                    }, 1000);
                }
                else if (lowerInput.includes('jugar') || lowerInput.includes('juego') || lowerInput.includes('divertir')) {
                    startInteractiveGame();
                }
                else if (lowerInput.includes('hola') || lowerInput.includes('hi') || lowerInput.includes('qu√© tal')) {
                    addBotMessage(`¬°Hola de nuevo, ${userName}! üòä ¬øC√≥mo est√°s hoy?`);
                }
                else if (lowerInput.includes('adi√≥s') || lowerInput.includes('chao') || lowerInput.includes('nos vemos')) {
                    addBotMessage(`¬°Hasta luego, ${userName}! Recuerda que siempre estoy aqu√≠ si necesitas hablar. Cu√≠date mucho. üòä`);
                }
                else if (lowerInput.includes('gracias') || lowerInput.includes('thank')) {
                    addBotMessage(`De nada, ${userName}. Estoy aqu√≠ para ayudarte siempre que lo necesites. üòä ¬øHay algo m√°s en lo que pueda ayudarte?`);
                }
                else if (lowerInput.includes('ayuda') || lowerInput.includes('recursos') || lowerInput.includes('profesional')) {
                    showHelpResources();
                }
                else {
                    // Respuesta conversacional gen√©rica que evita decir "no entend√≠"
                    const responses = [
                        `Entiendo, ${userName}. Voy a darte algunos consejos que podr√≠an ayudarte.`,
                        `Comprendo por lo que est√°s pasando, ${userName}. Aqu√≠ tienes algunas sugerencias.`,
                        `Vaya, ${userName}. Eso suena dif√≠cil. Te comparto algunas ideas que podr√≠an servirte.`,
                        `Gracias por compartir eso conmigo, ${userName}. Estos consejos podr√≠an ayudarte.`
                    ];
                    
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    addBotMessage(randomResponse);
                    setTimeout(() => {
                        giveSpecificAdvice();
                    }, 1000);
                }
            }
            
            // Funci√≥n para enviar mensaje
            function sendMessage() {
                const message = userInput.value.trim();
                if (message.length > 0) {
                    addUserMessage(message);
                    userInput.value = '';
                    
                    // Simular "escribiendo..."
                    setTimeout(() => {
                        handleUserInput(message);
                    }, 1000);
                }
            }
            
            // Event listeners
            sendButton.addEventListener('click', sendMessage);
            
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        });
    </script>
</body>
</html>